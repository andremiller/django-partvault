{% extends "partvault/base.html" %}

{% block content %}
<div class="d-flex align-items-center justify-content-between gap-3 flex-wrap mb-3">
    <div class="d-flex align-items-center gap-3">
        <h1 class="h3 mb-0">
            <a class="text-decoration-none" href="{% url 'items' collection.id %}">
                {{ collection.owner_code }} - {{ collection.name }} Items
            </a>
        </h1>
        <span class="badge bg-secondary">{{ item_list|length }}</span>
    </div>
    <div class="d-flex align-items-center gap-2">
        {% if request.user.is_authenticated and request.user == collection.owner %}
            <a class="btn btn-sm btn-outline-primary" href="{% url 'collection_edit' collection.id %}">Edit collection</a>
        {% endif %}
        {% if request.user.is_authenticated %}
            <a class="btn btn-sm btn-primary" href="{% url 'item_create' %}">New item</a>
        {% endif %}
    </div>
</div>
<div class="table-responsive pv-table-wrap">
    <table class="table table-hover align-middle">
        <thead>
            <tr>
                <th scope="col">Photo</th>
                <th scope="col">Asset tag</th>
                <th scope="col">Name</th>
                <th scope="col">Category</th>
                <th scope="col">Manufacturer</th>
                <th scope="col">Model</th>
                <th scope="col">Release date</th>
                <th scope="col">Tags</th>
                <th scope="col">Status</th>
            </tr>
        </thead>
        <tbody>
            {% for item in item_list %}
                <tr class="pv-clickable-row" data-href="{% url 'item' item.id %}">
                    <td data-label="Photo" class="pv-cell-photo">
                        {% with photo=item.ordered_photos.0 %}
                            {% if photo %}
                                <a href="{% url 'item' item.id %}" class="d-inline-block">
                                    <img
                                        src="{% url 'photo_image_scaled' photo.id 120 %}"
                                        alt="Thumbnail for {{ item.name }}"
                                        class="pv-thumb border"
                                    />
                                </a>
                            {% else %}
                                <div
                                    class="bg-light border rounded d-flex align-items-center justify-content-center text-muted"
                                    style="width: 56px; height: 56px;"
                                >
                                    â€”
                                </div>
                            {% endif %}
                        {% endwith %}
                    </td>
                    <td data-label="Asset tag">
                        <span class="pv-mobile-asset-media" aria-hidden="true">
                            {% with photo=item.ordered_photos.0 %}
                                {% if photo %}
                                    <img
                                        src="{% url 'photo_image_scaled' photo.id 120 %}"
                                        alt=""
                                        class="pv-thumb border"
                                    />
                                {% else %}
                                    <span
                                        class="bg-light border rounded d-flex align-items-center justify-content-center text-muted"
                                        style="width: 56px; height: 56px;"
                                    >
                                        -
                                    </span>
                                {% endif %}
                            {% endwith %}
                        </span>
                        <a class="text-decoration-none" href="{% url 'item' item.id %}">
                            {{ item.asset_tag|default:"-" }}
                        </a>
                    </td>
                    <td data-label="Name">{{ item.name }}</td>
                    <td data-label="Category">
                        {% if item.category %}
                            <a
                                class="text-decoration-none"
                                href="{% url 'items' collection.id %}?category={{ item.category.id }}"
                            >
                                {{ item.category }}
                            </a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td data-label="Manufacturer">
                        {% if item.manufacturer %}
                            <a
                                class="text-decoration-none"
                                href="{% url 'items' collection.id %}?manufacturer={{ item.manufacturer.id }}"
                            >
                                {{ item.manufacturer }}
                            </a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td data-label="Model">{{ item.model|default:"-" }}</td>
                    <td data-label="Release date">{{ item.release_date|date:"Y-m"|default:"-" }}</td>
                    <td data-label="Tags">
                        {% for tag in item.tags.all %}
                            <a
                                class="text-decoration-none"
                                href="{% url 'items' collection.id %}?tag={{ tag.id }}"
                            >
                                <span class="badge pv-tag me-1">{{ tag }}</span>
                            </a>
                        {% empty %}
                            <span class="text-muted">-</span>
                        {% endfor %}
                    </td>
                    <td data-label="Status">
                        {% if item.status %}
                            {% with status_color=item.status.color %}
                                <span class="badge {{ status_color }}{% if status_color == "bg-light" or status_color == "bg-warning" or status_color == "bg-info" %} text-dark{% else %} text-light{% endif %}">
                                    {{ item.status }}
                                </span>
                            {% endwith %}
                        {% else %}
                            <span class="badge bg-info text-dark">-</span>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr>
                    <td colspan="9" class="text-muted pv-table-empty">No items found.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
