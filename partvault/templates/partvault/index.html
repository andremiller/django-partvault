{% extends "partvault/base.html" %}
{% load settings_tags %}

{% block content %}
<div class="p-4 p-md-5 mb-4 pv-hero">
    <div class="container-fluid py-2">
        <h1 class="display-6 fw-semibold">{% setting "INDEX_HERO_HEADER" "Welcome to PartVault" %}</h1>
        <p class="lead pv-subtle mb-0">{% setting "INDEX_HERO_SUBTEXT" "This is Part Vault. Yet another inventory management program that allows you to keep track of what you have, where it is and what it looks like." %}</p>
        <div class="mt-3">
            <a class="btn btn-primary" href="{% url 'items_all' %}">View all items</a>
        </div>
    </div>
</div>
{% if request.user.is_authenticated %}
    <div class="pv-section-head">
        <h2 class="h6 mb-0">My Collections</h2>
        <span class="badge bg-secondary">{{ my_collections|length }}</span>
    </div>
    <div class="row g-3 mb-4">
        {% for collection in my_collections %}
            <div class="col-12 col-md-6 col-lg-4">
                <div class="card h-100 pv-collection-card">
                    <a
                        class="pv-collection-link"
                        href="{% url 'items' collection.id %}"
                        aria-label="View {{ collection.name }} collection"
                    >
                        View {{ collection.name }} collection
                    </a>
                    <div class="card-body">
                        <div class="d-flex align-items-start justify-content-between gap-2">
                            <h3 class="h5 fw-semibold mb-1">{{ collection.name }}</h3>
                            <span class="badge bg-secondary">{{ collection.item_count }} items</span>
                        </div>
                        <p class="pv-subtle mb-2">Owner: {{ collection.owner_code }}</p>
                            {% if collection.thumbnail_photos %}
                                <div class="d-flex flex-wrap gap-2 mb-2">
                                    {% for photo in collection.thumbnail_photos %}
                                        <div class="d-inline-block">
                                            <img
                                                src="{% url 'photo_image_scaled' photo.id 120 %}"
                                                alt="Thumbnail for {{ photo.item.name }}"
                                                class="pv-thumb border"
                                            />
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        <p class="small pv-subtle mb-0">
                            Last item update:
                            {% if collection.last_item_updated_at %}
                                {{ collection.last_item_updated_at|date:"Y-m-d" }}
                            {% else %}
                                No items yet
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="col-12">
                <div class="text-muted">No collections found.</div>
            </div>
        {% endfor %}
    </div>
{% endif %}

<div class="pv-section-head">
    <h2 class="h6 mb-0">Public Collections</h2>
    <span class="badge bg-secondary">{{ public_collections|length }}</span>
</div>
<div class="row g-3">
    {% for collection in public_collections %}
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 pv-collection-card">
                <a
                    class="pv-collection-link"
                    href="{% url 'items' collection.id %}"
                    aria-label="View {{ collection.name }} collection"
                >
                    View {{ collection.name }} collection
                </a>
                <div class="card-body">
                    <div class="d-flex align-items-start justify-content-between gap-2">
                        <h3 class="h5 fw-semibold mb-1">{{ collection.name }}</h3>
                        <span class="badge bg-secondary">{{ collection.item_count }} items</span>
                    </div>
                    <p class="pv-subtle mb-2">Owner: {{ collection.owner_code }}</p>
                    {% if collection.thumbnail_photos %}
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            {% for photo in collection.thumbnail_photos %}
                                <div class="d-inline-block">
                                    <img
                                        src="{% url 'photo_image_scaled' photo.id 120 %}"
                                        alt="Thumbnail for {{ photo.item.name }}"
                                        class="pv-thumb border"
                                    />
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                    <p class="small pv-subtle mb-0">
                        Last item update:
                        {% if collection.last_item_updated_at %}
                            {{ collection.last_item_updated_at|date:"Y-m-d" }}
                        {% else %}
                            No items yet
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    {% empty %}
        <div class="col-12">
            <div class="text-muted">No public collections found.</div>
        </div>
    {% endfor %}
</div>
{% endblock %}
