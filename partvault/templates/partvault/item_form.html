{% extends "partvault/base.html" %}
{% load django_bootstrap5 %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-sm-10 col-md-8 col-lg-6">
        <div class="card shadow-sm">
            <div class="card-body">
                <h1 class="h4 mb-3">{% if is_edit %}Edit item{% else %}New item{% endif %}</h1>
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    {% bootstrap_field form.collection %}
                    {% bootstrap_field form.name %}
                    <div class="row g-3">
                        <div class="col-md-8">
                            {% bootstrap_field form.category %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">New category</label>
                            {{ category_formset.management_form }}
                            {% for related_form in category_formset %}
                                {% bootstrap_field related_form.name show_label=False placeholder="Category name" %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-8">
                            {% bootstrap_field form.manufacturer %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">New manufacturer</label>
                            {{ manufacturer_formset.management_form }}
                            {% for related_form in manufacturer_formset %}
                                {% bootstrap_field related_form.name show_label=False placeholder="Manufacturer name" %}
                            {% endfor %}
                        </div>
                    </div>
                    {% bootstrap_field form.model %}
                    {% bootstrap_field form.revision %}
                    {% bootstrap_field form.serial %}
                    <div class="row g-3">
                        <div class="col-md-8">
                            {% bootstrap_field form.status %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">New status</label>
                            {{ status_formset.management_form }}
                            {% for related_form in status_formset %}
                                {% bootstrap_field related_form.name show_label=False placeholder="Status name" %}
                            {% endfor %}
                        </div>
                    </div>
                    {% bootstrap_field form.parent_item %}
                    <div class="row g-3">
                        <div class="col-md-8">
                            {% bootstrap_field form.tags %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">New tags</label>
                            {{ tag_formset.management_form }}
                            {% for related_form in tag_formset %}
                                {% bootstrap_field related_form.name show_label=False placeholder="Tag name" %}
                            {% endfor %}
                        </div>
                    </div>
                    <div class="mb-3">
                        <h2 class="h6">Photos</h2>
                        {{ photo_formset.non_form_errors }}
                        {{ photo_formset.management_form }}
                        {% for related_form in photo_formset %}
                            {{ related_form.id }}
                            <div class="row g-2 align-items-end mb-2">
                                <div class="col-md-8">
                                    {% bootstrap_field related_form.image show_label=False %}
                                </div>
                                <div class="col-md-3">
                                    {% bootstrap_field related_form.is_thumbnail %}
                                </div>
                                <div class="col-md-1">
                                    {% if related_form.instance.pk %}
                                        {% bootstrap_field related_form.DELETE show_label=False %}
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="mb-3">
                        <h2 class="h6">Documents</h2>
                        {{ document_formset.non_form_errors }}
                        {{ document_formset.management_form }}
                        {% for related_form in document_formset %}
                            {{ related_form.id }}
                            <div class="row g-2 align-items-end mb-2">
                                <div class="col-md-3">
                                    {% bootstrap_field related_form.document_type show_label=False %}
                                </div>
                                <div class="col-md-3">
                                    {% bootstrap_field related_form.new_document_type show_label=False placeholder="New type" %}
                                </div>
                                <div class="col-md-5">
                                    {% bootstrap_field related_form.file show_label=False %}
                                </div>
                                <div class="col-md-1">
                                    {% if related_form.instance.pk %}
                                        {% bootstrap_field related_form.DELETE show_label=False %}
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <div class="mb-3">
                        <h2 class="h6">Links</h2>
                        {{ link_formset.non_form_errors }}
                        {{ link_formset.management_form }}
                        {% for related_form in link_formset %}
                            {{ related_form.id }}
                            <div class="row g-2 align-items-end mb-2">
                                <div class="col-md-3">
                                    {% bootstrap_field related_form.link_type show_label=False %}
                                </div>
                                <div class="col-md-3">
                                    {% bootstrap_field related_form.new_link_type show_label=False placeholder="New type" %}
                                </div>
                                <div class="col-md-5">
                                    {% bootstrap_field related_form.url show_label=False %}
                                </div>
                                <div class="col-md-1">
                                    {% if related_form.instance.pk %}
                                        {% bootstrap_field related_form.DELETE show_label=False %}
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    {% bootstrap_field form.notes %}
                    <div class="row g-3">
                        <div class="col-md-6">
                            {% bootstrap_field form.acquired_on %}
                        </div>
                        <div class="col-md-6">
                            {% bootstrap_field form.last_tested_on %}
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-primary" type="submit">
                            {% if is_edit %}Save changes{% else %}Create item{% endif %}
                        </button>
                        {% if is_edit %}
                            <a class="btn btn-outline-secondary" href="{% url 'item' item.id %}">Cancel</a>
                        {% else %}
                            <a class="btn btn-outline-secondary" href="{% url 'items' %}">Cancel</a>
                        {% endif %}
                    </div>
                </form>
                {% if is_edit %}
                    <form
                        class="mt-3"
                        method="post"
                        action="{% url 'item_delete' item.id %}"
                        onsubmit="return confirm('Delete this item? This cannot be undone.');"
                    >
                        {% csrf_token %}
                        <button class="btn btn-outline-danger" type="submit">Delete item</button>
                    </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
